<!DOCTYPE html>
<html>
<head>
<title>Let's make some turns!</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: whitesmoke;
  }
  #gameCanvas {
    width: 100%;
    height: 100vh;
    display: block;
  }
  #characterSelect {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(255, 255, 255, 0.8);
    padding: 20px;
    border-radius: 10px;
    text-align: center;
  }
  #characterSelect h2 {
    font-size: 36px;
    margin-bottom: 20px;
  }
  #characterSelect button {
    padding: 10px 20px;
    margin: 10px;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
  }
  #characterSelect img {
    width: 50px;
    height: 50px;
    margin-right: 10px;
  }
  #gameOver {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(255, 255, 255, 0.8);
    padding: 20px;
    border-radius: 10px;
    text-align: center;
  }
  #gameOver button {
    padding: 10px 20px;
    margin: 10px;
    font-size: 16px;
    cursor: pointer;
  }
</style>
</head>
<body>
  <div id="characterSelect">
    <h2>Ski Shredders!</h2>
    <button onclick="startGame('snowboarder.png')"><img src="snowboarder.png" alt="Snowboarder">Snowboarder</button>
    <button onclick="startGame('pandaboarder.png')"><img src="pandaboarder.png" alt="Panda Jones">Panda Jones</button>
    <button onclick="startGame('astroboarder.png')"><img src="astroboarder.png" alt="Astronaut">Astronaut</button>
    <button onclick="startGame('ralphboarder.png')"><img src="ralphboarder.png" alt="Ralphie">Ralphie</button>
    <button onclick="startGame('eriboarder.png')"><img src="eriboarder.png" alt="Eri">Eri</button>
    <button onclick="startGame('mattboarder.png')"><img src="mattboarder.png" alt="Dustin Jones">Dustin Jones</button>
    <button onclick="startGame('claytonboarder.png')"><img src="claytonboarder.png" alt="Yeenon">Yeenon</button>
    <button onclick="startGame('kolbyboarder.png')"><img src="kolbyboarder.png" alt="HulkSmersh">HulkSmersh</button>
  </div>
  <canvas id="gameCanvas"></canvas>
  <div id="gameOver" style="display: none;">
    <h2>Game Over</h2>
    <img src="hand.png" alt="Hand" style="width: 50px; height: 50px;">
    <p id="finalScore"></p>
    <button onclick="restartGame()">Restart</button>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const characterSelect = document.getElementById('characterSelect');

    const mountainsImg = new Image();
    mountainsImg.src = 'mountains.png';
    const skiLodge = new Image();
    skiLodge.src = 'ski_lodge.png';
    const treeImg = new Image();
    treeImg.src = 'tree.png';
    const tree2Img = new Image();
    tree2Img.src = 'tree_2.png';
    const treeAspenImg = new Image();
    treeAspenImg.src = 'tree_aspen.png';
    const rockImg = new Image();
    rockImg.src = 'rock.png';
    const skierImg = new Image();
    skierImg.src = 'skier.png';
    const monsterImg = new Image();
    monsterImg.src = 'monster.png';
    const bonesImg = new Image();
    bonesImg.src = 'bones.png';
    
    let playerImg = new Image();
    let playerX = 100;
    let playerY = canvas.height / 2;
    let playerSize = 48;
    let scrollSpeed = 5;
    let progress = 0;
    let gameRunning = false;
    let startTime;
    let obstacles = [];
    let computerSkiers = [];
    let keys = {};
    let score = 0; // Add this line

    let monsterX = canvas.width;
    let monsterY = canvas.height / 2 - 60;
    let monsterSpeed = 10;

    const obstacleBoundingBoxes = {
      rock: { x: 15, y: 15, width: 18, height: 18 },
      tree: { x: 15, y: 10, width: 18, height: 38 },
      tree2: { x: 15, y: 10, width: 18, height: 38 },
      treeAspen: { x: 15, y: 10, width: 18, height: 38 }
    };
    
    function startGame(character) {
      playerImg.src = character;
      characterSelect.style.display = 'none';
      gameRunning = true;
      progress = 0;
      score = 0; // Reset score
      startTime = Date.now();
      obstacles = [];
      computerSkiers = [];
      generateObstacles();
      generateComputerSkiers();
      gameLoop();
    }

    function restartGame() {
      document.getElementById('gameOver').style.display = 'none';
      characterSelect.style.display = 'block';
    }

    document.addEventListener('keydown', (e) => { keys[e.key] = true; });
    document.addEventListener('keyup', (e) => { keys[e.key] = false; });

    function generateObstacles() {
      setInterval(() => {
        if (!gameRunning) return;
        if (Math.random() < 0.8) { // 80% chance to generate an obstacle
          let type = Math.random();
          let obstacleType;
          if (type < 0.33) {
            obstacleType = 'tree';
          } else if (type < 0.66) {
            obstacleType = 'tree2';
          } else {
            obstacleType = 'treeAspen';
          }
          let size = 60 + Math.random() * 40; // Random size between 60 and 100
          if (obstacleType === 'treeAspen') {
            size *= 1.3; // Make aspen trees 30% larger
          }
          obstacles.push({
            x: canvas.width,
            y: 180 + Math.random() * (canvas.height - 220),
            width: size,
            height: size,
            type: obstacleType
          });
        }
      }, 400);
    }

    function generateComputerSkiers() {
      setInterval(() => {
        if (!gameRunning) return;
        computerSkiers.push({
          x: canvas.width + Math.random() * 500,
          y: 180 + Math.random() * (canvas.height - 220),
          width: 48,
          height: 48,
          speed: 2 + Math.random() * 2
        });
      }, 800);
    }

    function update() {
      if (!gameRunning) return;

      progress += scrollSpeed;
      score = Math.floor(progress / 10); // Update score based on progress

      if (Date.now() - startTime >= 30000) {
        if (monsterX > playerX + playerSize) {
          monsterX -= monsterSpeed;
        }
        if (monsterY < playerY) {
          monsterY += monsterSpeed / 2;
        } else if (monsterY > playerY) {
          monsterY -= monsterSpeed / 2;
        }
        if (monsterX < playerX + playerSize && Math.abs(monsterY - playerY) < playerSize) {
          playerImg.src = 'bones.png';
          gameOver(false);
        }
      }

      if (keys.ArrowUp) playerY -= 5;
      if (keys.ArrowDown) playerY += 5;
      playerY = Math.max(180, Math.min(canvas.height - 140, playerY));

      for (const skier of computerSkiers) {
        skier.x -= skier.speed;
      }
      
      for (const obstacle of obstacles) {
        obstacle.x -= scrollSpeed;
      }
      
      obstacles = obstacles.filter(obstacle => obstacle.x + obstacle.width > 0);
      computerSkiers = computerSkiers.filter(skier => skier.x + skier.width > 0);

      for (const obstacle of obstacles) {
        const bbox = obstacleBoundingBoxes[obstacle.type];
        if (playerX < obstacle.x + bbox.x + bbox.width &&
            playerX + playerSize > obstacle.x + bbox.x &&
            playerY < obstacle.y + bbox.y + bbox.height &&
            playerY + playerSize > obstacle.y + bbox.y) {
          gameOver(false);
        }
      }

      for (const skier of computerSkiers) {
        if (playerX < skier.x + skier.width &&
            playerX + playerSize > skier.x &&
            playerY < skier.y + skier.height &&
            playerY + playerSize > skier.y) {
          gameOver(false);
        }
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      let bgX = -progress * 0.5 % canvas.width;
      ctx.drawImage(mountainsImg, bgX, 0, canvas.width, 200);
      ctx.drawImage(mountainsImg, bgX + canvas.width, 0, canvas.width, 200); 
      
      for (const obstacle of obstacles) {
        let img;
        if (obstacle.type === 'rock') {
          img = rockImg;
        } else if (obstacle.type === 'tree2') {
          img = tree2Img;
        } else if (obstacle.type === 'treeAspen') {
          img = treeAspenImg;
        } else {
          img = treeImg;
        }
        ctx.drawImage(img, obstacle.x, obstacle.y - obstacle.height * 0.5, obstacle.width, obstacle.height);
      }

      for (const skier of computerSkiers) {
        ctx.drawImage(skierImg, skier.x, skier.y, skier.width, skier.height);
      }

      ctx.drawImage(playerImg, playerX, playerY, playerSize, playerSize);
      
      // Display the score
      ctx.fillStyle = 'black';
      ctx.font = '24px Arial';
      ctx.fillText('Score: ' + score, 10, 30);

      if (Date.now() - startTime >= 30000) {
        ctx.drawImage(monsterImg, monsterX, monsterY, 120, 120);
      }
    }

    function gameLoop() {
      update();
      draw();
      if (gameRunning) {
        requestAnimationFrame(gameLoop);
      }
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function gameOver(success) {
      gameRunning = false;
      document.getElementById('gameOver').style.display = 'block';
      document.getElementById('finalScore').innerText = 'Your Score: ' + score;
    }
  </script>
</body>
</html>
